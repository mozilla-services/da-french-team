<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Service de nuages, ">

        <link rel="alternate"  href="https://mozilla-services.github.io/servicedenuages.fr/feeds/all.atom.xml" type="application/atom+xml" title="Service de nuages Full Atom Feed"/>

        <title>Kinto and ElasticSearch // Service de nuages // </title>


    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.3.0/pure-min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://mozilla-services.github.io/servicedenuages.fr/theme/css/pure.css">
    <link rel="stylesheet" href="https://mozilla-services.github.io/servicedenuages.fr/theme/css/pygments.css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fitvids/1.0.1/jquery.fitvids.min.js"></script>
    <script>
        $(document).ready(function(){
            $(".content").fitVids();
        });
    </script>
</head>

<body>
<div class="pure-g-r" id="layout">
    <div class="sidebar sidebar-article pure-u">
        <header class="header-article">
            <hgroup>
                <h5>Published</h5>
                <p title="~847 words">~4 minutes reading ðŸ•‘</p>
                <p>Wed, 21 June 2017</p>
                <a href="/en/">&larr; Back to articles</a>
            </hgroup>
        </header>
    </div>
    <div class="pure-u">
        <div class="content">
            <section class="post">
                <header class="post-header">
                    <h1>Kinto and ElasticSearch</h1>
                        <p class="post-meta">                                <a class="post-category" href="https://mozilla-services.github.io/servicedenuages.fr/tag/mozilla.html">mozilla</a>
                        </p>
                </header>
            </section>
            <div class="section" id="elasticsearch-integration">
<h2>ElasticSearch integration</h2>
<p>Kinto is a generic API on top of a storage backend.
ElasticSearch is a generic API on top of an indexing backend. When combining both,
your data is stored in a persistent database, and you can search, aggregate and
filter it efficiently.</p>
<p>This integration has been sitting around for a long time, since it was the subject of
our <a class="reference external" href="http://kinto.readthedocs.io/en/7.0.1/tutorials/write-plugin.html">Kinto plugin tutorial</a>. But recently, we had a concrete use-case at Mozilla
so we published it as <a class="reference external" href="https://github.com/Kinto/kinto-elasticsearch/">an official plugin</a>!</p>
</div>
<div class="section" id="use-case">
<h2>Use case</h2>
<p>Mozilla publishes its products for several platforms, in a lot of different locales (<em>70-100 regions/languages</em>),
and at different stages of maturity (<em>nightly, beta, release, ESR</em>). And currently there
is no comprehensive or official database for every released version and its associated
metadata (revision, build date, ...).</p>
<p>Our task was to build an API to allow third-party scripts and tools to publish or query
metadata about released products, as well as a nice UI to explore and browse the catalog.</p>
<p>Kinto gives us a ready-to-use JSON storage API, whose accessibility via <tt class="docutils literal">curl</tt> is rather intuitive,
and for which we can manage authentication and permissions using simple tokens or LDAP.
ElasticSearch gives us a rocket fast index that powers the faceted search of our catalog.</p>
<img alt="Prototype UI using SearchKit" src="https://mozilla-services.github.io/servicedenuages.fr/en/../images/buildhub-searchkit-screenshot.png" style="width: 1253px; height: auto; max-width: 100%;"/>
</div>
<div class="section" id="how-does-it-work">
<h2>How does it work?</h2>
<p>Basically, when enabling the plugin a new endpoint is available: <tt class="docutils literal"><span class="pre">/buckets/{bid}/collections/{cid}/search</span></tt></p>
<p>When the collection is created, a dedicated index is created on the underlying ElasticSearch cluster/instance.
When a record is created, it is duplicated in the collection index.
The <tt class="docutils literal">/search</tt> on the collection is just a pass-through endpoint of the collection, where you post a query and obtain the results.
You can only access it if you have the permission to read the whole collection.</p>
<p>By default, ElasticSearch will infer the field types from the posted data. But it is possible to define and force the mapping schema in the collection metadata.</p>
<p>The installation is straightforward:</p>
<div class="highlight"><pre><span></span>pip install kinto-elasticsearch
</pre></div>
<p>And activation is done as usual in the settings:</p>
<div class="highlight"><pre><span></span><span class="na">kinto.includes</span> <span class="o">=</span> <span class="s">kinto_elasticsearch</span>
<span class="na">kinto.elasticsearch.hosts</span> <span class="o">=</span> <span class="s">localhost:9200</span>
</pre></div>
</div>
<div class="section" id="example-with-geographical-data">
<h2>Example with geographical data</h2>
<p>ElasticSearch supports geospatial indices, which allow â€” for example â€” to filter points contained in a rectangle (aka. bounding box).</p>
<p>In this example, we'll import some OpenStreetMap data into a Kinto collection. <a class="reference external" href="https://kinto.github.io/kinto-elasticsearch/">A simple Leaflet map</a> will then display all records as dots on the map, and filter the list of results based on the current map extent using the search endpoint.</p>
<div class="section" id="loading-the-data">
<h3>Loading the data</h3>
<p>We can obtain some OSM export on &lt;<a class="reference external" href="http://overpass-turbo.eu">http://overpass-turbo.eu</a>&gt;. For example, the following query will return every pizzeria of Italy:</p>
<pre class="literal-block">
area[name="Italia"];(node["cuisine"="pizza"](area););out;
</pre>
<p>We export and save the result as <tt class="docutils literal">export.geojson</tt>.</p>
<img alt="Screenshot of query on overpass-turbo.eu" src="https://mozilla-services.github.io/servicedenuages.fr/en/../images/overpass-turbo.png" style="width: 1569px; height: auto; max-width: 100%;"/>
<p>We load it into Kinto using <a class="reference external" href="https://github.com/Kinto/kinto-http.py">kinto-http.py</a>:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">kinto_http</span>

<span class="n">server</span> <span class="o">=</span> <span class="s2">"http://localhost:8888/v1"</span>
<span class="n">bucket</span> <span class="o">=</span> <span class="s2">"restaurants"</span>
<span class="n">collection</span> <span class="o">=</span> <span class="s2">"pizzerias"</span>
<span class="n">auth</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"user"</span><span class="p">,</span> <span class="s2">"pass"</span><span class="p">)</span>

<span class="c1"># Create the destination bucket.</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">kinto_http</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">server_url</span><span class="o">=</span><span class="n">server</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="n">auth</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">create_bucket</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">if_not_exists</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
<p>We define the index and permissions. Each pizzeria will have a name and a location (long, lat).</p>
<div class="highlight"><pre><span></span><span class="c1"># Define the ElasticSearch mapping in the collection metadata.</span>
<span class="n">collection_metadata</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"index:schema"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"properties"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"name"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"text"</span>
            <span class="p">},</span>
            <span class="s2">"location"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"geo_point"</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1"># Let anonymous users read the records (online map demo).</span>
<span class="n">collection_permissions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"read"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"system.Everyone"</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">client</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">collection_metadata</span><span class="p">,</span>
                         <span class="n">permissions</span><span class="o">=</span><span class="n">collection_permissions</span><span class="p">,</span> <span class="n">if_not_exists</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
<p>Create a record for each Â«featureÂ» in the GeoJSON file, using batched requests (one HTTP request includes many creations):</p>
<div class="highlight"><pre><span></span><span class="n">export</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">"export.geojson"</span><span class="p">))</span>

<span class="k">with</span> <span class="n">client</span><span class="o">.</span><span class="n">batch</span><span class="p">()</span> <span class="k">as</span> <span class="n">batch</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">pizzeria</span> <span class="ow">in</span> <span class="n">export</span><span class="p">[</span><span class="s2">"features"</span><span class="p">]:</span>
        <span class="n">record</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"name"</span><span class="p">:</span> <span class="n">pizzeria</span><span class="p">[</span><span class="s2">"properties"</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"name"</span><span class="p">),</span>
            <span class="s2">"location"</span><span class="p">:</span> <span class="n">pizzeria</span><span class="p">[</span><span class="s2">"geometry"</span><span class="p">][</span><span class="s2">"coordinates"</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="n">batch</span><span class="o">.</span><span class="n">create_record</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">record</span><span class="p">,</span> <span class="n">bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="web-mapping">
<h3>Web mapping</h3>
<p>Now that the data is loaded in Kinto, indexed in ElasticSearch, and publicly available, we'll render a map.</p>
<p>Leaflet.js is a nice piece of software that makes webmapping really pleasant.</p>
<div class="highlight"><pre><span></span><span class="c1">// A map with OpenStreetMap background.</span>
<span class="kr">const</span> <span class="nx">map</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="s1">'map'</span><span class="p">);</span>
<span class="nx">L</span><span class="p">.</span><span class="nx">tileLayer</span><span class="p">(</span><span class="s1">'http://{s}.tile.osm.org/{z}/{x}/{y}.png'</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">attribution</span><span class="o">:</span> <span class="s1">'&amp;copy; &lt;a href="http://osm.org/copyright"&gt;OpenStreetMap&lt;/a&gt; contributors'</span>
<span class="p">}).</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>
</pre></div>
<p>Using <a class="reference external" href="https://github.com/Kinto/kinto-http.js/">kinto-http.js</a>, it is also quite intuitive to retrieve the whole list of records:</p>
<div class="highlight"><pre><span></span><span class="c1">// Fetch all records from Kinto to populate the map layer.</span>
<span class="c1">// (Note: this also could have been done using ES.)</span>
<span class="kr">const</span> <span class="nx">kinto</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">KintoClient</span><span class="p">(</span><span class="nx">server</span><span class="p">);</span>

<span class="nx">kinto</span><span class="p">.</span><span class="nx">bucket</span><span class="p">(</span><span class="nx">bucket</span><span class="p">).</span><span class="nx">collection</span><span class="p">(</span><span class="nx">collection</span><span class="p">).</span><span class="nx">listRecords</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(({</span><span class="nx">data</span><span class="o">:</span> <span class="nx">pizzerias</span><span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">});</span>
</pre></div>
<p>Showing records on the map is done like this. (Note: it would have been even simpler if Leaflet <a class="reference external" href="https://macwright.org/2016/07/15/longitude-latitude-is-the-right-way.html">hadn't followed</a> GMaps and used {long, lat} instead of {lat, long}.)</p>
<div class="highlight"><pre><span></span><span class="c1">// Add a circle on the map for each record.</span>
<span class="nx">pizzerias</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">pizzeria</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Leaflet maps use [lat, lng] and GeoJSON uses [lng, lat].</span>
  <span class="kr">const</span> <span class="nx">latlng</span> <span class="o">=</span> <span class="p">[</span><span class="nx">pizzeria</span><span class="p">.</span><span class="nx">location</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">pizzeria</span><span class="p">.</span><span class="nx">location</span><span class="p">[</span><span class="mi">0</span><span class="p">]];</span>

  <span class="nx">L</span><span class="p">.</span><span class="nx">circleMarker</span><span class="p">(</span><span class="nx">latlng</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">color</span><span class="o">:</span> <span class="s1">'purple'</span><span class="p">,</span>
    <span class="nx">fillOpacity</span><span class="o">:</span> <span class="mf">0.7</span>
  <span class="p">}).</span><span class="nx">setRadius</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
<p>In order to query the search endpoint, we use the <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">fetch API</a> and post a query that defines a filter using a rectangle:</p>
<div class="highlight"><pre><span></span><span class="nx">async</span> <span class="kd">function</span> <span class="nx">searchExtent</span><span class="p">(</span><span class="nx">bbox</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">query</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">bool</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">must</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">match_all</span><span class="o">:</span> <span class="p">{},</span>
        <span class="p">},</span>
        <span class="nx">filter</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">geo_bounding_box</span> <span class="o">:</span> <span class="p">{</span>
            <span class="nx">location</span><span class="o">:</span> <span class="p">{</span>
              <span class="nx">top</span><span class="o">:</span> <span class="nx">bbox</span><span class="p">.</span><span class="nx">getNorthWest</span><span class="p">().</span><span class="nx">lat</span><span class="p">,</span>
              <span class="nx">left</span><span class="o">:</span> <span class="nx">bbox</span><span class="p">.</span><span class="nx">getNorthWest</span><span class="p">().</span><span class="nx">lng</span><span class="p">,</span>
              <span class="nx">bottom</span><span class="o">:</span> <span class="nx">bbox</span><span class="p">.</span><span class="nx">getSouthEast</span><span class="p">().</span><span class="nx">lat</span><span class="p">,</span>
              <span class="nx">right</span><span class="o">:</span> <span class="nx">bbox</span><span class="p">.</span><span class="nx">getSouthEast</span><span class="p">().</span><span class="nx">lng</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">server</span><span class="si">}</span><span class="sb">/buckets/</span><span class="si">${</span><span class="nx">bucket</span><span class="si">}</span><span class="sb">/collections/</span><span class="si">${</span><span class="nx">collection</span><span class="si">}</span><span class="sb">/search`</span><span class="p">;</span>
  <span class="kr">const</span> <span class="p">{</span><span class="nx">hits</span><span class="o">:</span> <span class="p">{</span><span class="nx">hits</span><span class="p">}}</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">postJSON</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">query</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">hits</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">async</span> <span class="kd">function</span> <span class="nx">postJSON</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">body</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">body</span><span class="p">),</span>
    <span class="nx">method</span><span class="o">:</span> <span class="s2">"POST"</span><span class="p">,</span>
    <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span><span class="s2">"Content-Type"</span><span class="o">:</span> <span class="s2">"application/json"</span><span class="p">}</span>
  <span class="p">});</span>
  <span class="k">return</span> <span class="nx">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
<p>Now that we know how to render the map and obtain the list of records on a rectangle, we just need to listen to the map move event and refresh the list of results:</p>
<div class="highlight"><pre><span></span><span class="nx">map</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'load moveend'</span><span class="p">,</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Query ElasticSearch with the current map bounds as search extent.</span>
  <span class="kr">const</span> <span class="nx">bbox</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">getBounds</span><span class="p">();</span>
  <span class="kr">const</span> <span class="nx">hits</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">searchExtent</span><span class="p">(</span><span class="nx">bbox</span><span class="p">);</span>

  <span class="c1">// Render the results as a list of bullet points.</span>
  <span class="kr">const</span> <span class="nx">listing</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"listing"</span><span class="p">);</span>
  <span class="nx">listing</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
  <span class="nx">hits</span><span class="p">.</span><span class="nx">map</span><span class="p">(({</span><span class="nx">_source</span><span class="o">:</span> <span class="nx">pizzeria</span><span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">node</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"li"</span><span class="p">);</span>
    <span class="kr">const</span> <span class="nx">textnode</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="nx">pizzeria</span><span class="p">.</span><span class="nx">name</span> <span class="o">||</span> <span class="s2">"(No name)"</span><span class="p">);</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">textnode</span><span class="p">);</span>
    <span class="nx">listing</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
<p>Here you go!</p>
<p><a class="reference external" href="https://kinto.github.io/kinto-elasticsearch/">Online demo</a></p>
<img alt="kinto-elasticsearch map search extent" src="https://mozilla-services.github.io/servicedenuages.fr/en/../images/kinto-elasticsearch-demo.gif" style="width: 812px; height: auto; max-width: 100%;"/>
</div>
</div>

            <div class="hr"></div>
            <a href="#" class="go-top">Revenir au dÃ©but</a>
<div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = "servicedenuages"; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div><footer class="footer">
    <p>&copy; Service de nuages &ndash;
        DÃ©veloppÃ© avec <a href="https://github.com/PurePelicanTheme/pure">Pure Theme</a>
        et <a href="http://blog.getpelican.com/">Pelican</a>
    </p>
</footer>        </div>
    </div>
</div>
    <script>
        var $top = $('.go-top');

        // Show or hide the sticky footer button
        $(window).scroll(function() {
            if ($(this).scrollTop() > 200) {
                $top.fadeIn(200);
            } else {
                $top.fadeOut(200);
            }
        });

        // Animate the scroll to top
        $top.click(function(event) {
            event.preventDefault();
            $('html, body').animate({scrollTop: 0}, 300);
        })

        // Makes sure that the href="#" attached to the <a> elements
        // don't scroll you back up the page.
        $('body').on('click', 'a[href="#"]', function(event) {
            event.preventDefault();
        });
    </script>
<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//piwik.notmyidea.org/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//piwik.notmyidea.org/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->
  <script src="https://mozilla-services.github.io/servicedenuages.fr/theme/js/instantclick.min.js" data-no-instant></script>
  <script data-no-instant>InstantClick.init();</script>
</body>
</html>